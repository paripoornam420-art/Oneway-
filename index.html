<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DropTaxi Tamilnadu ‚Äî Oneway & Outstation Taxi</title>
  <meta name="description" content="DropTaxi Tamilnadu ‚Äî Drop Taxi, Oneway Taxi and Outstation cabs all major cities in Tamil Nadu. Transparent per km fares. WhatsApp booking: 8110000796." />
  <link rel="canonical" href="https://drop1taxi.netlify.app/" />

  <!-- Favicon -->
  <link rel="icon" href="/assets/droptaxi-logo.png" />
  <link rel="apple-touch-icon" href="/assets/droptaxi-logo.png" />

  <!-- Preconnect -->
  <link rel="preconnect" href="https://maps.googleapis.com" crossorigin>

  <style>
    :root{
      --yellow:#FFD000;
      --black:#111;
      --muted:#666;
      --accent:#0b6b3a;
      --green:#1a9a48;
      --bg:#f5f6f8;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background:var(--bg);
      color:var(--black);
      line-height:1.5;
    }
    a{text-decoration:none;color:inherit;}

    /* HEADER */
    header{
      position:sticky;
      top:0;
      z-index:50;
      background:#fff;
      border-bottom:1px solid #eee;
    }
    .header-inner{
      max-width:1100px;
      margin:0 auto;
      padding:8px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .header-left{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .menu-btn{
      border:0;
      background:none;
      font-size:26px;
      cursor:pointer;
    }
    .logo-wrap img{
      height:44px;
      display:block;
    }
    .call-btn{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:10px 14px;
      border-radius:10px;
      background:var(--yellow);
      color:#111;
      font-weight:800;
      border:1px solid rgba(0,0,0,0.05);
      white-space:nowrap;
    }

    /* MOBILE NAV */
    .nav-drawer-backdrop{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.4);
      opacity:0;
      pointer-events:none;
      transition:opacity .2s ease;
      z-index:80;
    }
    .nav-drawer{
      position:fixed;
      top:0;
      left:0;
      width:260px;
      height:100vh;
      background:#fff;
      box-shadow:2px 0 10px rgba(0,0,0,0.15);
      transform:translateX(-100%);
      transition:transform .22s ease;
      z-index:90;
      display:flex;
      flex-direction:column;
    }
    .nav-drawer-header{
      padding:14px 16px;
      border-bottom:1px solid #eee;
      font-weight:700;
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    .nav-drawer a{
      display:block;
      padding:10px 18px;
      border-bottom:1px solid #f3f3f3;
      color:#222;
      font-size:15px;
    }
    .nav-drawer a:hover{
      background:#f7f7f7;
    }
    .nav-open .nav-drawer-backdrop{
      opacity:1;
      pointer-events:auto;
    }
    .nav-open .nav-drawer{
      transform:translateX(0);
    }

    /* LAYOUT */
    .container{
      max-width:1100px;
      margin:20px auto 40px;
      padding:0 16px 24px;
    }

    /* HERO LOGO */
    .hero-logo-wrap{
      background:#fff;
      border-radius:14px;
      padding:14px 12px;
      margin-bottom:16px;
      box-shadow:0 6px 20px rgba(0,0,0,0.06);
      text-align:center;
    }
    .hero-logo-wrap img{
      max-width:280px;
      width:100%;
      height:auto;
      display:block;
      margin:0 auto;
    }

    /* HERO CARD + FORM */
    .hero-card{
      background:#fff;
      border-radius:18px;
      padding:18px 18px 22px;
      box-shadow:0 10px 30px rgba(0,0,0,0.06);
      margin-bottom:20px;
    }
    .hero-card h1{
      margin:0 0 8px;
      font-size:22px;
      font-weight:800;
    }
    .hero-sub{
      margin:0 0 16px;
      color:var(--muted);
      font-size:14px;
    }

    .trip-buttons{
      display:flex;
      gap:10px;
      margin-bottom:14px;
    }
    .trip-buttons button{
      flex:1;
      padding:11px 10px;
      border-radius:10px;
      border:1px solid #ddd;
      background:#fff;
      font-weight:700;
      cursor:pointer;
      font-size:15px;
    }
    .trip-buttons button.active{
      background:var(--yellow);
      border-color:var(--yellow);
    }

    .field{
      display:flex;
      flex-direction:column;
      margin-bottom:12px;
    }
    label{
      font-size:13px;
      color:#555;
      margin-bottom:5px;
    }
    input, select{
      padding:11px 11px;
      border-radius:9px;
      border:1px solid #ccc;
      font-size:15px;
      width:100%;
    }
    .row-2{
      display:flex;
      gap:10px;
    }
    .row-2 .field{flex:1;}

    .geo-btn,
    .estimate-btn{
      width:100%;
      border:none;
      border-radius:10px;
      padding:13px 12px;
      font-weight:800;
      font-size:16px;
      cursor:pointer;
      background:var(--green);
      color:#fff;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      box-shadow:0 8px 18px rgba(0,0,0,0.12);
    }
    .geo-btn[aria-busy="true"]{
      opacity:.85;
      cursor:wait;
    }
    .estimate-btn{margin-top:12px;}
    .geo-icon{font-size:17px;}

    /* Blinking effect for "Searching for location..." */
    .searching-location{
      animation: blink 1s linear infinite;
      color:#6b7280;
      font-style:italic;
    }
    @keyframes blink{
      0%,100%{opacity:1;}
      50%{opacity:0.35;}
    }

    /* ===== PREMIUM FARE ESTIMATE ‚Äì CENTER MODEL (UPDATED) ===== */
    .fare-premium-wrap{
      margin-top:20px;
      display:flex;
      justify-content:center;
      padding:0 8px;
    }

    .fare-premium{
      width:100%;
      max-width:480px;
      border-radius:26px;
      padding:20px;
      background:
        radial-gradient(circle at top left,rgba(22,163,74,0.22),transparent 55%),
        linear-gradient(145deg,#ffffff,#f4f6fb);
      box-shadow:0 18px 40px rgba(15,23,42,0.11);
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Arial;
      animation:fadeUp .35s ease-out;
      position:relative;
      overflow:hidden;
      display:none; /* HIDDEN INITIALLY, will show after Estimate */
    }

    @keyframes fadeUp{
      from{opacity:0;transform:translateY(10px);}
      to{opacity:1;transform:translateY(0);}
    }

    .fare-premium::after{
      content:"";
      position:absolute;
      width:230px;height:230px;
      border-radius:999px;
      background:radial-gradient(circle,rgba(34,197,94,0.28),transparent 70%);
      bottom:-130px;right:-90px;
    }

    .fare-route-main{
      font-size:18px;
      font-weight:800;
      color:#0a0a0a;
      margin-bottom:14px;
      text-align:center;
    }

    .fare-main-amount{
      font-size:30px;
      font-weight:900;
      color:#064e3b;
      text-align:center;
      line-height:1.2;
    }
    .fare-main-amount span{
      font-size:inherit;
      font-weight:inherit;
    }

    .fare-main-caption{
      font-size:14px;
      font-weight:700;
      color:#555;
      margin-top:6px;
      text-align:center;
    }

    .fare-note-prem{
      margin-top:8px;
      font-size:12px;
      color:#666;
      text-align:center;
    }

    /* Breakdown Toggle */
    .fare-break-prem-head{
      margin-top:16px;
      padding:8px 0;
      border-top:1px dashed #d1d5db;
      border-bottom:1px dashed #d1d5db;
      font-size:13px;
      font-weight:600;
      cursor:pointer;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .fare-break-arrow{
      width:22px;height:22px;border-radius:50%;
      border:1px solid #9ca3af;
      display:flex;align-items:center;justify-content:center;
      transition:.25s ease;
    }
    .fare-break-arrow.rotate{
      transform:rotate(90deg);
      background:#16a34a;
      color:#fff;
      border-color:#16a34a;
    }
    .fare-break-body{
      overflow:hidden;
      max-height:0;
      transition:max-height .25s ease;
      font-size:12px;
      color:#444;
    }
    .fare-break-body.open{max-height:230px;}

    .fare-break-list{list-style:none;padding:0;margin:8px 0 5px;}
    .fare-break-list li{
      display:flex;justify-content:space-between;
      margin-bottom:4px;
    }
    .fare-break-total{
      margin-top:4px;
      display:flex;justify-content:space-between;
      font-weight:700;
    }

    .fare-actions-prem{
      margin-top:16px;
    }
.btn-prem {
  width: 100%;
  display: block;
  position: relative;
  z-index: 999;
  pointer-events: auto;

  background: #ffc107;
  color: #000;
  font-weight: 600;
  padding: 14px;
  border: none;
  border-radius: 8px;
}

    /* WHY CHOOSE */
    .why-card{
      background:#fff;
      border-radius:18px;
      padding:18px 18px 20px;
      box-shadow:0 8px 22px rgba(0,0,0,0.06);
      margin-bottom:22px;
    }
    .why-card h2{
      margin:0 0 10px;
      font-size:20px;
    }
    .why-card ul{
      padding-left:20px;
      margin:8px 0 0;
      color:#444;
      font-size:14px;
    }

    /* FOOTER */
    footer{
      background:#0b6b3a;
      color:#fff;
      padding:18px 16px 22px;
      font-size:13px;
    }
    .footer-inner{
      max-width:1100px;
      margin:0 auto;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:space-between;
    }
    footer a{color:#fff;text-decoration:underline;}

    /* FLOATING BUTTONS */
    .fab-wrap{
      position:fixed;
      right:16px;
      bottom:18px;
      display:flex;
      flex-direction:column;
      gap:10px;
      z-index:70;
      align-items:flex-end;
    }
    .fab-btn{
      border:none;
      border-radius:999px;
      padding:10px 15px;
      font-weight:800;
      font-size:14px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:6px;
      box-shadow:0 8px 20px rgba(0,0,0,0.25);
    }
    .fab-wa{
      background:linear-gradient(180deg,#25D366,#128C7E);
      color:#fff;
    }
    .fab-call{
      background:var(--yellow);
      color:#111;
    }

    /* TOAST */
    #wa-toast{
      position:fixed;
      left:50%;
      bottom:22px;
      transform:translateX(-50%);
      background:rgba(0,0,0,0.88);
      color:#fff;
      padding:8px 13px;
      border-radius:999px;
      font-size:13px;
      opacity:0;
      pointer-events:none;
      transition:opacity .18s ease;
      z-index:120;
      max-width:90%;
      text-align:center;
    }

    /* Make Google Places suggestions visible on top */
    .pac-container{
      z-index:9999 !important;
    }

    @media (max-width:720px){
      .hero-card h1{font-size:20px;}
      .fare-main-amount{font-size:26px;}
      .fare-premium{
        padding:16px 14px 18px;
        border-radius:20px;
      }
      .fare-route-main{font-size:16px;}
    }
  </style>
</head>
<body>
<header>
  <div class="header-inner">
    <div class="header-left">
      <button id="menuBtn" class="menu-btn" aria-label="Menu">‚ò∞</button>
      <div class="logo-wrap">
        <a href="index.html">
          <img src="/assets/droptaxi-logo.png" alt="DropTaxi Tamilnadu Logo">
        </a>
      </div>
    </div>
    <a class="call-btn" href="tel:8110000796">
      üìû 8110000796
    </a>
  </div>
</header>

<!-- Nav drawer -->
<div id="navBackdrop" class="nav-drawer-backdrop"></div>
<nav id="navDrawer" class="nav-drawer" aria-hidden="true">
  <div class="nav-drawer-header">
    <span>Menu</span>
    <button id="navClose" class="menu-btn" aria-label="Close menu">‚úï</button>
  </div>
  <a href="index.html">üè† Home</a>
  <a href="service-cities.html">üìç Service Cities</a>
  <a href="thoothukudi-drop-taxi.html">üöï Thoothukudi Drop Taxi</a>
  <a href="about-us.html">‚ÑπÔ∏è About Us</a>
  <a href="privacy-policy.html">üîí Privacy Policy</a>
  <a href="terms-and-conditions.html">üìÑ Terms &amp; Conditions</a>
  <a href="cancellation-policy.html">‚ùå Cancellation Policy</a>
  <a href="luggage-policy.html">üß≥ Luggage Policy</a>
</nav>

<main class="container">
  <!-- Hero logo -->
  <section class="hero-logo-wrap">
    <img src="/assets/droptaxi-logo.png" alt="DropTaxi Tamilnadu">
  </section>

  <!-- Booking card -->
  <section class="hero-card" id="bookingFormCard">
    <h1>DropTaxi Tamilnadu ‚Äî Oneway &amp; Outstation Cabs at Best Price</h1>
    <p class="hero-sub">
      Book safe and reliable <strong>Drop Taxi, Oneway Taxi and Outstation Cabs</strong> across Tamil Nadu.
      Get Instant fare estimate and Book Your Ride.
    </p>

    <!-- Trip type -->
    <div class="trip-buttons" role="tablist" aria-label="Trip type">
      <button id="onewayBtn" class="active" role="tab" aria-selected="true">Oneway</button>
      <button id="roundBtn" role="tab" aria-selected="false">Round Trip</button>
      <input type="hidden" id="tripType" value="Oneway">
    </div>

    <!-- Form -->
    <form id="bookingForm" novalidate>
      <div class="field">
        <label for="pickup">Pickup Location</label>
        <input id="pickup" name="pickup" type="text"
               placeholder="Enter pickup location (e.g., Madurai, Chennai, Airport)"
               autocomplete="off" required />
      </div>

      <div class="field">
        <button id="useLocationBtn" type="button" class="geo-btn" aria-busy="false">
          <span class="geo-icon">üìç</span>
          <span>Use My Current Location</span>
        </button>
      </div>

      <div class="field">
        <label for="drop">Drop Location</label>
        <input id="drop" name="drop" type="text"
               placeholder="Enter drop location" autocomplete="off" required />
      </div>

      <div class="row-2">
        <div class="field">
          <label for="date">Date</label>
          <input id="date" name="date" type="date" required />
        </div>
        <div class="field">
          <label for="time">Time</label>
          <input id="time" name="time" type="time" required />
        </div>
      </div>

      <div id="returnRow" class="field" style="display:none;">
        <label for="returnDate">Return Date (for Round Trip)</label>
        <input id="returnDate" name="returnDate" type="date" />
      </div>

      <div class="field">
        <label for="car">Car Type</label>
        <select id="car" name="car">
          <option value="hatchback">Hatchback</option>
          <option value="sedan" selected>Sedan</option>
          <option value="innova">Innova / MPV</option>
          <option value="suv">SUV</option>
        </select>
      </div>

      <div class="field">
        <label for="phone">Contact Number</label>
        <input id="phone" name="phone" type="tel"
               placeholder="Enter your mobile number"
               inputmode="tel"
               pattern="[\d\+\-\s()]{10,20}"
               required />
      </div>

      <button id="estimateBtn" type="button" class="estimate-btn">
        Estimate
      </button>

      <!-- ===== PREMIUM FARE ESTIMATE ‚Äì CENTER MODEL (UPDATED) ===== -->
      <div class="fare-premium-wrap">
        <section class="fare-premium" id="farePremiumCard">

          <!-- Route text (dynamic) -->
          <div class="fare-route-main" id="routeTitle">
            Thoothukudi ‚Üí Madurai (Oneway)
          </div>

          <!-- Fare line: same font, same line -->
          <div class="fare-main-amount">
            ‚Çπ<span id="fareAmount">6,394</span>
            <span> / upto <span id="uptoKmDisplay">461 km</span></span>
          </div>

          <!-- Extra km line -->
          <div class="fare-main-caption">
            Extra Km : ‚Çπ<span id="extraKmFare">13</span> per km
          </div>

          <!-- Note -->
          <div class="fare-note-prem">
            Parking, Entrance Fees &amp; State Permit Only Extra
          </div>

          <!-- Breakdown area -->
          <div class="fare-break-prem-head" id="fareBreakToggle">
            Fare Breakdown
            <div class="fare-break-arrow" id="fareBreakArrow">‚Ä∫</div>
          </div>

          <div class="fare-break-body" id="fareBreakBody">
            <ul class="fare-break-list">
              <li><span>Distance</span><span id="bdKm">461 km</span></li>
              <li><span>Distance Fare</span><span id="distFare">‚Çπ5,994</span></li>
              <li><span>Driver Bata</span><span id="driverBata">‚Çπ400</span></li>
              <li><span>Toll &amp; Other Charges</span><span id="tollCharges">‚Çπ0</span></li>
            </ul>
            <div class="fare-break-total">
              <span>Total</span>
              <span id="totalFareSmall">‚Çπ6,394</span>
            </div>
          </div>

          <!-- Single Book Now button -->
          <div class="fare-actions-prem">
<div class="book-now-wrapper" onclick="bookNowPro()">
  <button class="btn-prem" type="button">
    Book Now
  </button>
</div>

        </section>
      </div>
    </form>
  </section>

  <!-- Why choose section -->
  <section class="why-card">
    <h2>Why choose DropTaxi Tamilnadu?</h2>
    <ul>
      <li>Transparent per km fares</li>
      <li>Professional, experienced drivers</li>
      <li>Instant WhatsApp booking confirmation</li>
      <li>Service from Tamilnadu to all major TN cities</li>
    </ul>
  </section>
</main>

<footer>
  <div class="footer-inner">
    <div>
      <strong>DropTaxi Tamilnadu</strong><br>
      Since 2019 ‚Äî Drop Taxi, Oneway Taxi &amp; Tour Packages across Tamil Nadu.
    </div>
    <div>
      üìû Call: <a href="tel:8110000796">8110000796</a> &nbsp;|&nbsp;
      üí¨ WhatsApp: <a href="https://wa.me/918110000796" target="_blank" rel="noopener">Chat now</a>
    </div>
  </div>
</footer>

<div id="wa-toast" role="status" aria-live="polite"></div>

<!-- Floating buttons -->
<div class="fab-wrap">
  <button id="floatingWhatsApp" class="fab-btn fab-wa">üí¨ WhatsApp</button>
  <button id="floatingCall" class="fab-btn fab-call">
    üìû 8110000796
  </button>
</div>


<script>
  // ------------ CONFIG ------------
  const WA_NUMBER = "918110000796";
  const CALL_NUMBER = "tel:8110000796";
  const el = id => document.getElementById(id);

  }

  // Tariff data
  const TARIFFS = {
    Oneway: {
      hatchback: { rate: 13.00, bata: 400 },
      sedan:     { rate: 14.00, bata: 300 },
      suv:       { rate: 19.00, bata: 400 },
      innova:    { rate: 20.00, bata: 400 }
    },
    "Round Trip": {
      hatchback: { rate: 12.70, bata: 400 },
      sedan:     { rate: 13.00, bata: 400 },
      suv:       { rate: 18.00, bata: 400 },
      innova:    { rate: 19.00, bata: 400 }
    },
    minimumKm: { Oneway: 130, "Round Trip": 250 } // per day for round trip
  };

  const HILL_KEYWORDS = ["ooty","kodaikanal","kodai","munnar","yercaud","valparai"];

  function fmtINR(n){
    return "‚Çπ" + Number(n).toLocaleString("en-IN", {
      maximumFractionDigits: (Number(n)%1===0?0:2)
    });
  }

  // ------------ MAPS / AUTOCOMPLETE ------------
  let gmapsReady=false, distanceService=null, geocoder=null, pickupAuto=null, dropAuto=null;

  function initMaps(){
    try{
      pickupAuto = new google.maps.places.Autocomplete(el("pickup"), { types:["geocode"] });
      dropAuto   = new google.maps.places.Autocomplete(el("drop"),   { types:["geocode"] });

      const indiaBounds = new google.maps.LatLngBounds(
        {lat:6.5,lng:68.1},
        {lat:35.6,lng:97.3}
      );
      pickupAuto.setBounds(indiaBounds);
      dropAuto.setBounds(indiaBounds);

      distanceService = new google.maps.DistanceMatrixService();
      geocoder = new google.maps.Geocoder();
      gmapsReady = true;
    }catch(e){
      console.warn("Maps init failed", e);
      gmapsReady = false;
    }
  }

  // expose for Google callback
  window.initMaps = initMaps;

  // ------------ HELPER: TOAST ------------
  function showToast(msg){
    const toast = el("wa-toast");
    if(!toast) return;
    toast.textContent = msg;
    toast.style.opacity = "1";
    setTimeout(()=>{ toast.style.opacity = "0"; }, 2200);
  }

  // ------------ HILL STATION DETECT ------------
  function isHillRoute(pickup, drop){
    const text = (pickup + " " + drop).toLowerCase();
    return HILL_KEYWORDS.some(k => text.includes(k));
  }

  // Helper: parse ‚Çπxx,xxx to number
  function parseAmount(id){
    const elmt = document.getElementById(id);
    if(!elmt) return 0;
    const txt = elmt.textContent.replace(/[^0-9.]/g,"");
    const val = parseFloat(txt);
    return isNaN(val) ? 0 : val;
  }

  // Recalculate total & main fare from breakdown (includes Toll automatically)
  function recalcTotalFromBreakdown(){
    const dist = parseAmount("distFare");
    const bata = parseAmount("driverBata");
    const toll = parseAmount("tollCharges");
    const total = dist + bata + toll;

    const formatted = total.toLocaleString("en-IN");

    const totalSmallEl = document.getElementById("totalFareSmall");
    const fareAmountEl = document.getElementById("fareAmount");
    if(totalSmallEl) totalSmallEl.textContent = "‚Çπ" + formatted;
    if(fareAmountEl) fareAmountEl.textContent = formatted;
  }

  // ---------- UPDATED bookNowPro (drop-in replacement) ----------
  function bookNowPro(){
    // Grab values from the page
    const pickupCity = (document.getElementById("pickup")?.value || "").trim();
    const dropCity   = (document.getElementById("drop")?.value || "").trim();
    const phone      = (document.getElementById("phone")?.value || "").trim();
    const tripType   = (document.getElementById("tripType")?.value || "Oneway").trim();
    const carType    = (document.getElementById("car")?.value || "").trim();
    const date       = (document.getElementById("date")?.value || "").trim();
    const time       = (document.getElementById("time")?.value || "").trim();
    const returnDate = (document.getElementById("returnDate")?.value || "").trim();

    // Fare related
    const fareTextEl = document.getElementById("fareAmount");
    const uptoKmEl   = document.getElementById("uptoKmDisplay");
    const extraKmEl  = document.getElementById("extraKmFare");

    const fare = fareTextEl ? (fareTextEl.textContent || "").replace(/[^0-9.,]/g,"").trim() : "";
    const uptoKm = uptoKmEl ? (uptoKmEl.textContent || "").trim() : "";
    const extraKmRate = extraKmEl ? (extraKmEl.textContent || "").trim() : "";

    // Compute total days for round trip if returnDate present
    let totalDaysText = "";
    if(tripType === "Round Trip" && returnDate){
      try{
        const d1 = new Date(date);
        const d2 = new Date(returnDate);
        // inclusive day count (if return same day => 1)
        const diffDays = Math.max(1, Math.round((d2 - d1) / (1000*60*60*24)) + 1);
        totalDaysText = diffDays.toString();
      }catch(e){
        totalDaysText = "";
      }
    }

    // Build message using WhatsApp simple markdown for bold (*text*)
    const lines = [];
    lines.push("*BOOKING CONFIRMATION ‚Äì DROP TAXI*");
    lines.push("");
    lines.push(`*${pickupCity} ‚Üí ${dropCity}*`);
    lines.push("");
    lines.push(`*Contact Number:* ${phone}`);
    lines.push(`*Pickup:* ${pickupCity}`);
    lines.push(`*Drop:* ${dropCity}`);
    lines.push(`*Trip Type:* ${tripType}`);
    lines.push(`*Car Type:* ${carType}`);
    lines.push(`*Date:* ${date}`);
    lines.push(`*Time:* ${time}`);
    if(tripType === "Round Trip" && returnDate){
      lines.push(`*Return Date:* ${returnDate}`);
      if(totalDaysText) lines.push(`*Total Days:* ${totalDaysText}`);
    }
    lines.push("");
    lines.push(`*Estimated Fare:* ‚Çπ${fare}`);
    lines.push(`*Upto Km:* ${uptoKm}`);
    lines.push(`*Extra Km:* ‚Çπ${extraKmRate} / km`);
    lines.push("");
    // Important notes: always show 1 & 2, show 3 & 4 only for Oneway
    lines.push("1. Toll, Parking, State Permit (Rs.800) Charges Extra");
    lines.push("2. Details will be shared 4 hours before pickup time.");
    if(tripType === "Oneway"){
      lines.push("3. Multiple Pickup And Drop Will Be Charged Rs.150 /Per Stop");
      lines.push("4. No Local Trips Allowed On Oneway Trips");
    }
    lines.push("");
    lines.push("For Bookings and Enquiry");
    lines.push("Website: https://droptaxitamilnadu2.netlify.app/");
    lines.push("Call Us : 811 00 00 796");
    lines.push("");
    lines.push("Thanks for choosing Us. We wish you a safe and comfortable journey.");

    const message = lines.join("\n");
function generateBookingId() {
  const now = new Date();
  const months = ["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"];
  const month = months[now.getMonth()];
  const year = now.getFullYear();

  const key = `DT_${month}_${year}_COUNT`;
  let count = Number(localStorage.getItem(key) || 0) + 1;
  localStorage.setItem(key, count);

  return `DT-${month}-${String(count).padStart(3,"0")}/${year}`;
}

function bookNowPro() {

  ‚úÖ const bookingId = generateBookingId();  // ‚Üê THIS LINE

  sendToGoogleScript({
    mailType: "booking",
    bookingId: bookingId,
    tripType: el("tripType").value,
    pickup: el("pickup").value,
    drop: el("drop").value,
    date: el("date").value,
    time: el("time").value,
    returnDate: el("returnDate")?.value || "",
    totalDays: "",
    car: el("car").value,
    km: el("uptoKmDisplay").textContent,
    rate: el("extraKmFare").textContent,
    bata: el("driverBata").textContent.replace("‚Çπ",""),
    totalFare: el("fareAmount").textContent.replace("‚Çπ",""),
    phone: el("phone").value
  });

  alert(
    "‚úÖ Booking received successfully!\n\n" +
    "Booking ID: " + bookingId + "\n" +
    "Our team will contact you shortly."
  );
}
function bookNowPro(){


  sendToGoogleScript({
    mailType: "booking",
    bookingId: bookingId,
    tripType: el("tripType").value,
    pickup: el("pickup").value,
    drop: el("drop").value,
    date: el("date").value,
    time: el("time").value,
    returnDate: el("returnDate")?.value || "",
    totalDays: "",
    car: el("car").value,
    km: el("uptoKmDisplay").textContent,
    rate: el("extraKmFare").textContent,
    bata: el("driverBata").textContent.replace("‚Çπ",""),
    totalFare: el("fareAmount").textContent.replace("‚Çπ",""),
    phone: el("phone").value
  });

  alert(
    "‚úÖ Booking received successfully!\n\n" +
    "Booking ID: " + bookingId + "\n" +
    "Our team will contact you shortly."
  );
}

window.bookNowPro = bookNowPro;
  
  window.addEventListener("DOMContentLoaded", () => {
    const body = document.body;

    // Nav drawer
    const menuBtn = el("menuBtn");
    const navDrawer = el("navDrawer");
    const navBackdrop = el("navBackdrop");
    const navClose = el("navClose");

    function openNav(){
      body.classList.add("nav-open");
      navDrawer.setAttribute("aria-hidden","false");
    }
    function closeNav(){
      body.classList.remove("nav-open");
      navDrawer.setAttribute("aria-hidden","true");
    }
    if(menuBtn) menuBtn.addEventListener("click", openNav);
    if(navClose) navClose.addEventListener("click", closeNav);
    if(navBackdrop) navBackdrop.addEventListener("click", closeNav);

    // Trip type toggle
    const onewayBtn = el("onewayBtn");
    const roundBtn = el("roundBtn");
    const tripTypeInput = el("tripType");
    const returnRow = el("returnRow");

    function setTripType(type){
      tripTypeInput.value = type;
      if(type === "Oneway"){
        onewayBtn.classList.add("active");
        roundBtn.classList.remove("active");
        onewayBtn.setAttribute("aria-selected","true");
        roundBtn.setAttribute("aria-selected","false");
        returnRow.style.display = "none";
      }else{
        roundBtn.classList.add("active");
        onewayBtn.classList.remove("active");
        roundBtn.setAttribute("aria-selected","true");
        onewayBtn.setAttribute("aria-selected","false");
        returnRow.style.display = "block";
      }
    }
    if(onewayBtn) onewayBtn.addEventListener("click", () => setTripType("Oneway"));
    if(roundBtn) roundBtn.addEventListener("click", () => setTripType("Round Trip"));

    // Default date & time
    const dateInput = el("date");
    const timeInput = el("time");
    if(dateInput){
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth()+1).padStart(2,"0");
      const dd = String(today.getDate()).padStart(2,"0");
      dateInput.value = `${yyyy}-${mm}-${dd}`;
      dateInput.min = `${yyyy}-${mm}-${dd}`;
    }
    if(timeInput){
      const now = new Date();
      const hh = String(now.getHours()).padStart(2,"0");
      const mins = String(now.getMinutes()).padStart(2,"0");
      timeInput.value = `${hh}:${mins}`;
    }

    // Floating buttons
    const floatingWhatsApp = el("floatingWhatsApp");
    const floatingCall = el("floatingCall");

    if(floatingCall){
      floatingCall.addEventListener("click", () => {
        window.location.href = CALL_NUMBER;
      });
    }

    // Use My Current Location
    const useLocationBtn = el("useLocationBtn");
    if (useLocationBtn) {
      useLocationBtn.addEventListener("click", () => {
        if (useLocationBtn.getAttribute("aria-busy") === "true") return;

        if (!navigator.geolocation) {
          alert("Location not supported in this browser. Please type manually.");
          return;
        }

        const pickupInput = el("pickup");
        if (pickupInput) {
          pickupInput.dataset.prevValue = pickupInput.value;
          pickupInput.value = "Searching for location.....";
          pickupInput.classList.add("searching-location");
        }

        useLocationBtn.setAttribute("aria-busy", "true");
        useLocationBtn.disabled = true;

        const resetPickup = (fallbackText) => {
          const input = el("pickup");
          if (!input) return;
          input.classList.remove("searching-location");
          if (fallbackText) {
            input.value = fallbackText;
          } else if (input.dataset.prevValue !== undefined) {
            input.value = input.dataset.prevValue;
          }
          delete input.dataset.prevValue;
        };

        navigator.geolocation.getCurrentPosition(
          (pos) => {
            const { latitude, longitude } = pos.coords;

            if (!gmapsReady || !geocoder) {
              console.warn("Maps not ready yet");
              resetPickup();
              alert("Maps is still loading, please try again in a moment.");
              useLocationBtn.removeAttribute("aria-busy");
              useLocationBtn.disabled = false;
              return;
            }

            geocoder.geocode({ location: { lat: latitude, lng: longitude } }, (results, status) => {
              if (status === "OK" && results[0]) {
                const input = el("pickup");
                if (input) {
                  input.classList.remove("searching-location");
                  input.value = results[0].formatted_address;
                  delete input.dataset.prevValue;
                }
              } else {
                resetPickup();
                alert("Couldn't fetch address. Please type location manually.");
              }
              useLocationBtn.removeAttribute("aria-busy");
              useLocationBtn.disabled = false;
            });
          },
          (err) => {
            console.error(err);
            resetPickup();
            alert("Couldn't get your location. Please allow location access or type manually.");
            useLocationBtn.removeAttribute("aria-busy");
            useLocationBtn.disabled = false;
          },
          {
            enableHighAccuracy: true,
            timeout: 15000,
            maximumAge: 0
          }
        );
      });
    }

    // Fare card & estimate
    const estimateBtn = el("estimateBtn");
    const routeTitle = el("routeTitle");
    const fareAmountEl = el("fareAmount");
    const uptoKmDisplay = el("uptoKmDisplay");
    const extraKmFare = el("extraKmFare");
    const bdKm = el("bdKm");
    const distFareEl = el("distFare");
    const driverBataEl = el("driverBata");
    const tollChargesEl = el("tollCharges");


    function calculateAndShowFare(distanceKm, pickup, drop, tripType, carType, daysCount=1){
      const tariffsByTrip = TARIFFS[tripType];
      const config = tariffsByTrip[carType];
const perDayMinKm = 250; // minimum per day for round trip

let usedKm;
if (tripTypeEl.value === "Round Trip") {  const endDate = new Date(el("returnDate").value);

  if (!isNaN(startDate) && !isNaN(endDate) && endDate >= startDate) {
    const diffTime = endDate - startDate;
    daysCount = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
  }

  usedKm = Math.max(
    roundedDistance,
    perDayMinKm * daysCount
  );
} else {
  // One way logic
  usedKm = Math.max(
    roundedDistance,
    minimumOnewayKm
  );
}

      // Distance fare
      const distFare = usedKm * config.rate;

      // Driver bata: for round trip multiply by days
      const driverBata = (tripType === "Round Trip") ? (config.bata * daysCount) : config.bata;

      const hill = isHillRoute(pickup, drop);
      const tollChargesVal = hill ? 300 : 0;

      // Fill UI
      routeTitle.textContent = `${pickup} ‚Üí ${drop} (${tripType})`;
      uptoKmDisplay.textContent = `${usedKm} km`;
      extraKmFare.textContent = config.rate.toString().replace(/\.00$/,"");

      bdKm.textContent = `${usedKm} km`;
      distFareEl.textContent = fmtINR(distFare);
      driverBataEl.textContent = fmtINR(driverBata);
      tollChargesEl.textContent = fmtINR(tollChargesVal);

      // Sync total & main fare
      recalcTotalFromBreakdown();

      // SHOW FARE CARD AFTER SUCCESSFUL ESTIMATE
// SHOW ESTIMATE CARD + SUDDEN JUMP
const card = document.getElementById("farePremiumCard");

if (card) {
  card.style.display = "block";

  // ‚ùó INSTANT JUMP (NO SMOOTH)
  card.scrollIntoView(true);
}
}

sendToGoogleScript({
  mailType: "estimate",
  bookingId: "BT" + Date.now(),
  tripType: tripType,
  pickup: pickup,
  drop: drop,
  date: el("date").value,
  time: el("time").value,
  returnDate: el("returnDate")?.value || "",
  totalDays: daysCount,
  car: carType,
  km: el("uptoKmDisplay").textContent,
  rate: el("extraKmFare").textContent,
  bata: el("driverBata").textContent.replace("‚Çπ",""),
  totalFare: el("fareAmount").textContent.replace("‚Çπ",""),
  phone: el("phone").value
});
      showToast("Estimated fare shown below.");
    }

    if(estimateBtn){
      estimateBtn.addEventListener("click", () => {
        const pickup = el("pickup").value.trim();
        const drop = el("drop").value.trim();
        const phone = el("phone").value.trim();
        const carType = el("car").value;
        const tripType = el("tripType").value;

        if(!pickup || !drop){
          alert("Please enter both Pickup and Drop locations.");
          return;
        }
        if(!phone){
          alert("Please enter your contact number.");
          return;
        }
// üî¥ ROUND TRIP VALIDATION (ADD HERE)
if (tripType === "Round Trip" && !el("returnDate").value) {
alert("Please select Return Date for Round Trip");
el("returnDate").focus();  return;
}
        // compute days if round trip
        let daysCount = 1;
        if(tripType === "Round Trip"){
          const start = new Date(el("date").value);
          const ret = new Date(el("returnDate").value || el("date").value);
          try{
            const diffDays = Math.ceil((ret - start) / (1000 * 60 * 60 * 24)) + 1
            daysCount = diffDays;
          }catch(e){
            daysCount = 1;
          }
        }

        if(!gmapsReady || !distanceService){
          // fallback: use only minimum km (respecting round trip days)
          console.warn("Maps not ready, using minimum km fallback.");
          const approxKm = (tripType === "Round Trip") ? (TARIFFS.minimumKm["Round Trip"] * daysCount) : (TARIFFS.minimumKm[tripType] || 130);
          calculateAndShowFare(approxKm, pickup, drop, tripType, carType, daysCount);
          return;
        }

        distanceService.getDistanceMatrix(
          {
            origins: [pickup],
            destinations: [drop],
            travelMode: google.maps.TravelMode.DRIVING,
            unitSystem: google.maps.UnitSystem.METRIC
          },
          (response, status) => {
            if(status !== "OK"){
              console.warn("DistanceMatrix error:", status);
              const approxKm = (tripType === "Round Trip") ? (TARIFFS.minimumKm["Round Trip"] * daysCount) : (TARIFFS.minimumKm[tripType] || 130);
              calculateAndShowFare(approxKm, pickup, drop, tripType, carType, daysCount);
              return;
            }

            try{
              const element = response.rows[0].elements[0];
              if(element.status !== "OK"){
                console.warn("DistanceMatrix element error:", element.status);
                const approxKm = (tripType === "Round Trip") ? (TARIFFS.minimumKm["Round Trip"] * daysCount) : (TARIFFS.minimumKm[tripType] || 130);
                calculateAndShowFare(approxKm, pickup, drop, tripType, carType, daysCount);
                return;
              }
              const distanceMeters = element.distance.value;
              let distanceKm = distanceMeters / 1000;

              // For round trip, use from-to-from (double the one-way)
              if(tripType === "Round Trip"){
                distanceKm = distanceKm * 2;
              }

              calculateAndShowFare(distanceKm, pickup, drop, tripType, carType, daysCount);
            }catch(e){
              console.error(e);
              const approxKm = (tripType === "Round Trip") ? (TARIFFS.minimumKm["Round Trip"] * daysCount) : (TARIFFS.minimumKm[tripType] || 130);
              calculateAndShowFare(approxKm, pickup, drop, tripType, carType, daysCount);
            }
          }
        );
      });
    }

    // Fare breakdown toggle
    const fbToggle = document.getElementById("fareBreakToggle");
    const fbBody   = document.getElementById("fareBreakBody");
    const fbArrow  = document.getElementById("fareBreakArrow");

    if(fbToggle){
      fbToggle.addEventListener("click", () => {
        fbBody.classList.toggle("open");
        fbArrow.classList.toggle("rotate");
      });
    }

    // Initial recalc for default static values
    recalcTotalFromBreakdown();
  });
</script>

<!-- Google Maps JS with callback -->
<script
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBXnBk1mKSeIF5_UNsLejhqUYFIbJqMXZk&libraries=places&callback=initMap"
  async
  defer>
</script>
</body>
</html>