<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Cab Booking</title>
<style>
body{margin:0;font-family:Arial;background:#f3f3f3}
.header{background:#000;color:#ffb300;text-align:center;padding:18px;font-size:28px;font-weight:700}
.card{background:#fff;margin:16px;padding:18px;border-radius:26px}
.toggle{display:flex;background:#eee;border-radius:30px;padding:4px}
.toggle button{flex:1;padding:12px;border:none;border-radius:26px;font-size:16px}
.toggle .active{background:#ffc107}
.input{width:100%;margin-top:14px;padding:16px;border-radius:22px;border:1px solid #ddd;background:#f5f5f5}
.main-btn{margin-top:20px;width:100%;padding:18px;background:#ffc107;border:none;border-radius:40px;font-size:20px;font-weight:700}
.add-stop{margin-top:10px;color:#007bff;font-weight:bold}
</style>
</head>

<body>

<div class="header">cabbazar</div>

<div class="card">

<div class="toggle">
  <button id="oneBtn" class="active" onclick="setTrip('one')">One Way</button>
  <button id="roundBtn" onclick="setTrip('round')">Round Trip</button>
</div>

<input class="input" id="pickup" placeholder="Pickup Location">
<input class="input" type="button" value="ðŸ“ Use My Current Location" onclick="useCurrentLocation()">

<div id="stops"></div>
<div id="addStopBtn" class="add-stop" onclick="addStop()" style="display:none">+ Add Stop</div>

<input class="input" id="drop" placeholder="Final Drop Location">

<input class="input" id="date" type="date">
<input class="input" id="time" type="time">
<input class="input" id="mobile" placeholder="+91 Enter mobile number" maxlength="10">

<button class="main-btn" onclick="calculateKm()">Check Price & Book Cab</button>

</div>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBXnBk1mKSeIF5_UNsLejhqUYFIbJqMXZk&libraries=places"></script>

<script>
let tripType="one", geocoder, directionsService;

function initMaps(){
  new google.maps.places.Autocomplete(pickup);
  new google.maps.places.Autocomplete(drop);
  geocoder=new google.maps.Geocoder();
  directionsService=new google.maps.DirectionsService();
}
window.onload=initMaps;

function setTrip(t){
  tripType=t;
  oneBtn.classList.toggle("active",t==="one");
  roundBtn.classList.toggle("active",t==="round");
  addStopBtn.style.display=t==="round"?"block":"none";
  stops.innerHTML="";
}

function addStop(){
  const i=document.createElement("input");
  i.className="input";
  i.placeholder="Stop Location";
  new google.maps.places.Autocomplete(i);
  stops.appendChild(i);
}

function useCurrentLocation(){
  navigator.geolocation.getCurrentPosition(pos=>{
    geocoder.geocode({location:{lat:pos.coords.latitude,lng:pos.coords.longitude}},res=>{
      pickup.value=res[0].formatted_address;
    });
  });
}

function calculateKm(){
  if(!/^[6-9]\d{9}$/.test(mobile.value)){alert("Invalid mobile");return;}

  let waypoints=[];
  document.querySelectorAll("#stops input").forEach(s=>{
    waypoints.push({location:s.value,stopover:true});
  });

  let destination=drop.value;
  if(tripType==="round") waypoints.push({location:drop.value,stopover:true});

  directionsService.route({
    origin:pickup.value,
    destination:tripType==="round"?pickup.value:drop.value,
    waypoints:waypoints,
    travelMode:"DRIVING"
  },res=>{
    let km=0;
    res.routes[0].legs.forEach(l=>km+=l.distance.value);
    km=Math.round(km/1000);

    localStorage.setItem("trip",JSON.stringify({
      pickup:pickup.value,
      drop:drop.value,
      km:km,
      mobile:mobile.value,
      date:date.value,
      time:time.value
    }));
    location.href="fare.html";
  });
}
</script>
</body>
</html>