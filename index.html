<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cab Booking</title>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:#f3f3f3}
.header{background:#000;color:#ffb300;text-align:center;padding:18px;font-size:28px;font-weight:700}
.card{background:#fff;margin:16px;padding:18px;border-radius:26px}
.toggle{display:flex;background:#eee;border-radius:30px;padding:4px}
.toggle button{flex:1;padding:12px;border:none;border-radius:26px;font-size:16px;font-weight:600;background:transparent}
.toggle .active{background:#ffc107}
.input{width:100%;margin-top:14px;padding:16px;border-radius:22px;border:1px solid #e0e0e0;background:#f5f5f5;font-size:16px}
.dt-row{display:flex;gap:10px;margin-top:14px}
.main-btn{margin-top:22px;width:100%;padding:18px;background:#ffc107;border:none;border-radius:40px;font-size:20px;font-weight:700}
.loc-status{display:none;margin-top:8px;padding:10px;border-radius:18px;background:#fff3cd}
</style>
</head>

<body>

<div class="header">DropTaxi</div>

<div class="card">

<div class="toggle">
  <button id="oneBtn" class="active" onclick="setTrip('one')">One Way</button>
  <button id="roundBtn" onclick="setTrip('round')">Round Trip</button>
</div>

<input class="input" id="pickup" placeholder="Pickup Location">
<div id="locStatus" class="loc-status">ðŸŸ¡ Location Detectingâ€¦</div>
<input class="input" type="button" value="ðŸ“ Use My Current Location" onclick="useCurrentLocation()">

<input class="input" id="drop" placeholder="Final Drop Location">

<div class="dt-row">
  <input class="input" id="date" type="date">
  <input class="input" id="time" type="time">
</div>

<input class="input" id="returnDate" type="date" style="display:none">

<input class="input" id="mobile" maxlength="10" placeholder="+91 Enter mobile number">

<button class="main-btn" onclick="checkFare()">Check Price & Book Cab</button>

</div>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBXnBk1mKSeIF5_UNsLejhqUYFIbJqMXZk&libraries=places"></script>

<script>
const SCRIPT_URL="https://script.google.com/macros/s/AKfycbyb50XEKPuIY1BOMVsQwIlcPuwdyTFajmtXwl8zYyiQsPJKMEZ8epmJN6pOrA0l5yEU/exec";
let geocoder,currentMapLink="",tripType="one";

function initMaps(){
  new google.maps.places.Autocomplete(pickup);
  new google.maps.places.Autocomplete(drop);
  geocoder=new google.maps.Geocoder();
}
window.onload=initMaps;

function setTrip(t){
  tripType=t;
  oneBtn.classList.toggle("active",t==="one");
  roundBtn.classList.toggle("active",t==="round");
  returnDate.style.display=t==="round"?"block":"none";
}

function useCurrentLocation(){
  locStatus.style.display="block";
  navigator.geolocation.getCurrentPosition(pos=>{
    const lat=pos.coords.latitude,lng=pos.coords.longitude;
    currentMapLink=`https://www.google.com/maps?q=${lat},${lng}`;
    geocoder.geocode({location:{lat,lng}},res=>{
      pickup.value=res[0].formatted_address;
      locStatus.style.display="none";
    });
  });
}

function checkFare(){
  if(!/^[6-9]\d{9}$/.test(mobile.value)){alert("Invalid mobile");return;}

  fetch(SCRIPT_URL,{
    method:"POST",
    body:JSON.stringify({
      type:"search",
      route:`${pickup.value} to ${drop.value}`,
      mobile:mobile.value,
      datetime:`${date.value} - ${time.value}`,
      car:"Searching",
      fare:"-",
      uptoKm:"-",
      mapLink:currentMapLink || pickup.value
    })
  });

  localStorage.setItem("tripData",JSON.stringify({
    pickup:pickup.value,
    drop:drop.value,
    mobile:mobile.value,
    date:date.value,
    time:time.value,
    tripType
  }));

  setTimeout(()=>location.href="fare.html",800);
}
</script>
</body>
</html>